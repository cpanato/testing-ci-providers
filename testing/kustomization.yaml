apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - "https://github.com/cert-manager/cert-manager/releases/download/v1.11.1/cert-manager.yaml"

patchesJSON6902:
  # dogfood our chainguard images:
  # ref: https://github.com/chainguard-images/images/tree/main/images/cert-manager-controller
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: cert-manager
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: cgr.dev/chainguard/cert-manager-controller:latest@sha256:8a256b6ec720ce81e422dfec63f681a39de41d39d86b7924ede838228f95b905

  # ref: https://github.com/chainguard-images/images/tree/main/images/cert-manager-cainjectors
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: cert-manager-cainjector
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: cgr.dev/chainguard/cert-manager-cainjector:latest@sha256:3d4598e57b49d05c92f9496350b4f831be85a62f66e2d572d524c0152ed1fcc9

  # ref: https://github.com/chainguard-images/images/tree/main/images/cert-manager-webhook
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: cert-manager-webhook
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: cgr.dev/chainguard/cert-manager-webhook:latest@sha256:c45cd1f09c89b047bf3f448aa174e6fe093fa665b8a1851764d9baec4882265e

  # ref: https://github.com/chainguard-images/images/tree/main/images/cert-manager-acmesolver
  # When updating to a new certmanager release this please make sure that the args are still in that position
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: cert-manager
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/args/3
        value: --acme-http01-solver-image=cgr.dev/chainguard/cert-manager-acmesolver:latest@sha256:c416388dad892b258265e63af68f06395e89289e3152d4e70447bace5e98328d
